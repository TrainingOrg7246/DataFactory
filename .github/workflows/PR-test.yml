name: Deploy ADF to test

on:
  release:
    types: [published]

jobs:
  deploy:
    runs-on: ubuntu-latest
    environment:
      name: test

    steps:
    - name: Checkout code
      uses: actions/checkout@v3
      with:
        ref: main
    - name: Log in to Azure
      uses: azure/login@v1
      with:
              creds: ${{ secrets.AZURE_CREDENTIALS }}
    - name: Deploy ADF ARM Template
      uses: azure/arm-deploy@v1
      with:
        subscriptionId: ${{ secrets.AZURE_SUBSCRIPTION }}
        
        resourceGroupName: rg-test
        template: ./dev-adf-vikash/ARMTemplateForFactory.json
        parameters: ./dev-adf-vikash/ARMTemplateParametersForFactory.json
        deploymentName: adf-deployment-${{ github.run_number }}
        deploymentMode: Incremental
